FROM crime_reports;"
dbGetQuery(con, sql)
# get the city
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)')
FROM crime_reports;"
dbGetQuery(con, sql)
# get the city
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+)\\n')
FROM crime_reports;"
dbGetQuery(con, sql)
# get the city
# look for one word \w+ or two words \\w+|\\w+|\\w+
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n')
FROM crime_reports;"
dbGetQuery(con, sql)
# crime type
sql <- "SELECT crime_id,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):')
FROM crime_reports;"
dbGetQuery(con, sql)
# description
sql <- "SELECT crime_id,
regexp_match(original_text, ':\\s(.+)(?:CO|SO)')
FROM crime_reports;"
dbGetQuery(con, sql)
# case number
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:CO|SO)[0-9]+')
FROM crime_reports;"
dbGetQuery(con, sql)
# case number
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:Co|SO)[0-9]+')
FROM crime_reports;"
dbGetQuery(con, sql)
# case number
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:CO|SO)[0-9]+')
FROM crime_reports;"
dbGetQuery(con, sql)
# case number
sql <- "SELECT crime_id,
regexp_match(original_text, '(?:C0|SO)[0-9]+')
FROM crime_reports;"
dbGetQuery(con, sql)
# description
sql <- "SELECT crime_id,
regexp_match(original_text, ':\\s(.+)(?:C0|SO)')
FROM crime_reports;"
dbGetQuery(con, sql)
# let's put it all together in a dataframe
sql <- "SELECT
regexp_match(original_text, '(?:C0|SO)[0-9]+') AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
# let's put it all together in a dataframe
sql <- "SELECT
regexp_match(original_text, '(?:C0|SO)[0-9]+')[1] AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
# let's put it all together in a dataframe
sql <- "SELECT cime_id,
regexp_match(original_text, '(?:C0|SO)[0-9]+')[1] AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
# grab it out of the {}
sql <- "SELECT cime_id,
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number
FROM crime_reports;"
df <- dbGetQuery(con, sql)
# grab it out of the {}
sql <- "SELECT crime_id,
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
# let's put it all together in a dataframe
sql <- "SELECT crime_id
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
# let's put it all together in a dataframe
sql <- "SELECT
regexp_match(original_text, '(?:C0|SO)[0-9]+') AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
dbGetQuery(con, sql)
# grab it out of the {}
sql <- "SELECT crime_id,
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number
FROM crime_reports;"
dbGetQuery(con, sql)
# let's put it all together in a dataframe
sql <- "SELECT
regexp_match(original_text, '(?:C0|SO)[0-9]+') AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}') AS date_1,
regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):') AS crime_type,
regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n') AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1] AS date_1,
(regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1] AS crime_type,
(regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n'))[1] AS city
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1] AS date_1,
(regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n'))[1] AS city
(regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1] AS crime_type,
(regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1] AS description,
FROM crime_reports;"
df <- dbGetQuery(con, sql)
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1] AS date_1,
(regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n'))[1] AS city,
(regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1] AS crime_type,
(regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1] AS description
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
# let's see what it looks like when we save it
write_csv(df,'test.csv', na = '')
str_match('The game starts at 7 p.m. on May 2, 2019.' , '\\d{4}')
# In R
str_replace("bat","b","c")
# we know there are line breaks in the description field, so we can fix that in R
df$description <- str_replace(df$description,"\n"," ")
View(df)
# let's see if that worked
write_csv(df,'test2.csv', na = '')
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1] AS date_1,
(regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n'))[1] AS city,
(regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1] AS crime_type,
(regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1] AS description
FROM crime_reports;"
df <- dbGetQuery(con, sql)
# almost. Is there a str_replace all?
# we know there are line breaks in the description field, so we can fix that in R
df$description <- str_replace_all(df$description,"\n"," ")
# let's see if that worked
write_csv(df,'test3.csv', na = '')
# disconnect
dbDisconnect(con)
dbUnloadDriver(drv)
# set directory
setwd("~/anaconda3/envs/pracSQL/Chapter_13_text")
# load libraries
library(tidyverse)
#library('readxl')
library("RPostgreSQL")
options("scipen" = 10)
# connect to postgres (remembert to turn it on)
drv <- dbDriver("PostgreSQL")
# connect to aranalysis (for pracSQL)
con <- dbConnect(drv, dbname = "aranalysis",
host = "localhost", port = 5432,
user = "tbroderick")
# upper(), lower(), initcap
sql <- "SELECT initcap('hello');"
dbGetQuery(con, sql)
sql <- "SELECT
(regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1] AS case_number,
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1] AS date_1,
(regexp_match(original_text, '(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\n'))[1] AS city,
(regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1] AS crime_type,
(regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1] AS description
FROM crime_reports;"
df <- dbGetQuery(con, sql)
View(df)
# almost. Is there a str_replace all?
# recreate the df, then
df$description <- str_replace_all(df$description,"\n"," ")
sql <- "SELECT * FROM crime_reports;"
dbGetQuery(con, sql)
||' US/Eastern'
)::timestamptz;"
# updating crime_reports table with extracted data
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\d{1,2}\/\d{1,2}\/\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\/\d{2}\n(\d{4})'))[1]
||' US/Eastern')::timestamptz;"
# updating crime_reports table with extracted data
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz;"
dbGetQuery(con, sql)
sql <- "SELECT crime_id, date_1, original_text FROM crime_reports;"
dfx <- dbGetQuery(con, sql)
View(dfx)
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,
'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,
'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
sql <- "UPDATE crime_reports SET date_1 = (
(regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
dbGetQuery(con, sql)
sql <- "UPDATE crime_reports SET date_1 = ((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1];"
# connect to postgres (remembert to turn it on)
drv <- dbDriver("PostgreSQL")
# connect to aranalysis (for pracSQL)
con <- dbConnect(drv, dbname = "aranalysis",
host = "localhost", port = 5432,
user = "tbroderick")
sql <- "UPDATE crime_reports SET date_1 = ((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
dbGetQuery(con, sql)
# disconnect
dbDisconnect(con)
dbUnloadDriver(drv)
# disconnect
dbDisconnect(con)
# disconnect
dbDisconnect(con)
dbUnloadDriver(drv)
# disconnect
dbDisconnect(con)
sql <- "UPDATE crime_reports
SET date_1 = ((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
sql <- "UPDATE crime_reports
SET date_1 = ((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
dbGetQuery(con, sql)
# connect to postgres (remembert to turn it on)
drv <- dbDriver("PostgreSQL")
# connect to aranalysis (for pracSQL)
con <- dbConnect(drv, dbname = "aranalysis",
host = "localhost", port = 5432,
user = "tbroderick")
sql <- "UPDATE crime_reports
SET date_1 = ((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n(\\d{4})'))[1]
||' US/Eastern')::timestamptz,
date_2 =
CASE
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '\\d{1,2}\\/\\d{1,2}\\/\\d{2}'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
WHEN (SELECT regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})') IS NOT NULL)
AND (SELECT regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})') IS NOT NULL)
THEN
((regexp_match(original_text, '-(\\d{1,2}\\/\\d{1,2}\\/\\d{1,2})'))[1]
|| ' ' ||
(regexp_match(original_text, '\\/\\d{2}\\n\\d{4}-(\\d{4})'))[1]
||' US/Eastern')::timestamptz
ELSE NULL
END,
street = (regexp_match(original_text, 'hrs.\\n(\\d+ .+(?:Sq.|Plz.|Dr.|Ter.|Rd.))'))[1],
city = (regexp_match(original_text,'(?:Sq.|Plz.|Dr.|Ter.|Rd.)\\n(\\w+ \\w+|\\w+|\\w+)\\n'))[1],
crime_type = (regexp_match(original_text, '\\n(?:\\w+ \\w+|\\w+|\\w+)\\n(.*):'))[1],
description = (regexp_match(original_text, ':\\s(.+)(?:C0|SO)'))[1],
case_number = (regexp_match(original_text, '(?:C0|SO)[0-9]+'))[1];"
dbGetQuery(con, sql)
sql <- "SELECT case_number, date_1, street, city, crime_type, description
FROM crime_reports;"
dfy <- dbGetQuery(con, sql)
View(dfy)
# disconnect
dbDisconnect(con)
dbUnloadDriver(drv)
