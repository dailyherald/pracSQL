data=df,
fill=factor(fy),
bins = 30
)
qplot(margin,
data=df,
fill=factor(fy),
bins = 30
)
qplot(net_income,
data=df,
fill=factor(fy),
bins = 30
)
qplot(compensation_perc,
data=df,
fill=factor(fy),
bins = 30
)
setwd("~/anaconda3/envs/notebook/analysis/ignore/children_hospitals")
library(tidyverse)
options("scipen" = 10)
df <- read.csv("data.csv", header=T, na.strings=c("-","NA"))
summary(df)
# save summary stats in a dataframe so we can refer to them later
dfsum <- data.frame(unclass(summary(df)), check.names = FALSE, stringsAsFactors = FALSE)
write_csv(dfsum,'data_summary.csv')
qplot(totalNPR,
data=df,
fill=factor(fy),
bins = 30
)
qplot(margin,
data=df,
fill=factor(fy),
bins = 30
)
qplot(net_income,
data=df,
fill=factor(fy),
bins = 30
)
qplot(compensation_perc,
data=df,
fill=factor(fy),
bins = 30
)
years <- table(df$fy)
years
df5 <- filter(df$fy != c("2011","2018"))
years5 <- table(df$fy)
years5
years5 <- table(df5$fy)
df5 <- filter(df$fy %in% c("2012","2013","2014","2015","2016","2017"))
years5 <- table(df5$fy)
df5 <- filter(!df$fy %in% c("2011","2018"))
df5 <- filter(!df, fy %in% c("2011","2018"))
df5 <- filter(!df, fy %in% c(2011,2018))
df5 <- filter(df, !fy %in% c(2011,2018))
years5 <- table(df5$fy)
years5
qplot(totalNPR,
data=df5,
fill=factor(fy),
bins = 30
)
qplot(margin,
data=df5,
fill=factor(fy),
bins = 30
)
qplot(net_income,
data=df5,
fill=factor(fy),
bins = 30
)
qplot(compensation_perc,
data=df5,
fill=factor(fy),
bins = 30
)
View(df5)
setwd("~/anaconda3/envs/pracSQL/Chapter_08")
setwd("~/anaconda3/envs/pracSQL/Chapter_08")
setwd("~/anaconda3/envs/pracSQL/Chapter_08")
library("RPostgreSQL")
# loads the PostgreSQL driver
drv <- dbDriver("PostgreSQL")
# creates a connection to the postgres database
con <- dbConnect(drv, dbname = "aranalysis",
host = "localhost", port = 5432,
user = "tbroderick")#, password = pw)
sql <- "
CREATE TABLE pls_fy2014_pupld14a (
stabr varchar(2) NOT NULL,
fscskey varchar(6) CONSTRAINT fscskey2014_key PRIMARY KEY,
libid varchar(20) NOT NULL,
libname varchar(100) NOT NULL,
obereg varchar(2) NOT NULL,
rstatus integer NOT NULL,
statstru varchar(2) NOT NULL,
statname varchar(2) NOT NULL,
stataddr varchar(2) NOT NULL,
longitud numeric(10,7) NOT NULL,
latitude numeric(10,7) NOT NULL,
fipsst varchar(2) NOT NULL,
fipsco varchar(3) NOT NULL,
address varchar(35) NOT NULL,
city varchar(20) NOT NULL,
zip varchar(5) NOT NULL,
zip4 varchar(4) NOT NULL,
cnty varchar(20) NOT NULL,
phone varchar(10) NOT NULL,
c_relatn varchar(2) NOT NULL,
c_legbas varchar(2) NOT NULL,
c_admin varchar(2) NOT NULL,
geocode varchar(3) NOT NULL,
lsabound varchar(1) NOT NULL,
startdat varchar(10),
enddate varchar(10),
popu_lsa integer NOT NULL,
centlib integer NOT NULL,
branlib integer NOT NULL,
bkmob integer NOT NULL,
master numeric(8,2) NOT NULL,
libraria numeric(8,2) NOT NULL,
totstaff numeric(8,2) NOT NULL,
locgvt integer NOT NULL,
stgvt integer NOT NULL,
fedgvt integer NOT NULL,
totincm integer NOT NULL,
salaries integer,
benefit integer,
staffexp integer,
prmatexp integer NOT NULL,
elmatexp integer NOT NULL,
totexpco integer NOT NULL,
totopexp integer NOT NULL,
lcap_rev integer NOT NULL,
scap_rev integer NOT NULL,
fcap_rev integer NOT NULL,
cap_rev integer NOT NULL,
capital integer NOT NULL,
bkvol integer NOT NULL,
ebook integer NOT NULL,
audio_ph integer NOT NULL,
audio_dl float NOT NULL,
video_ph integer NOT NULL,
video_dl float NOT NULL,
databases integer NOT NULL,
subscrip integer NOT NULL,
hrs_open integer NOT NULL,
visits integer NOT NULL,
referenc integer NOT NULL,
regbor integer NOT NULL,
totcir integer NOT NULL,
kidcircl integer NOT NULL,
elmatcir integer NOT NULL,
loanto integer NOT NULL,
loanfm integer NOT NULL,
totpro integer NOT NULL,
totatten integer NOT NULL,
gpterms integer NOT NULL,
pitusr integer NOT NULL,
wifisess integer NOT NULL,
yr_sub integer NOT NULL
);
"
dbGetQuery(con, sql)
sql <- "SELECT * FROM pls_fy2014_pupld14a"
df <- dbGetQuery(con, sql)
View(df)
sql <- "
CREATE INDEX libname2014_idx ON pls_fy2014_pupld14a (libname);
CREATE INDEX stabr2014_idx ON pls_fy2014_pupld14a (stabr);
CREATE INDEX city2014_idx ON pls_fy2014_pupld14a (city);
CREATE INDEX visits2014_idx ON pls_fy2014_pupld14a (visits);
COPY pls_fy2014_pupld14a
FROM '/Users/tbroderick/anaconda3/envs/pracSQL/Chapter_08/pls_fy2014_pupld14a.csv'
WITH (FORMAT CSV, HEADER);
"
dbGetQuery(con, sql)
sql <- "SELECT * FROM pls_fy2014_pupld14a"
df <- dbGetQuery(con, sql)
View(df)
nrow(df)
sql <- "
CREATE TABLE pls_fy2009_pupld09a (
stabr varchar(2) NOT NULL,
fscskey varchar(6) CONSTRAINT fscskey2009_key PRIMARY KEY,
libid varchar(20) NOT NULL,
libname varchar(100) NOT NULL,
address varchar(35) NOT NULL,
city varchar(20) NOT NULL,
zip varchar(5) NOT NULL,
zip4 varchar(4) NOT NULL,
cnty varchar(20) NOT NULL,
phone varchar(10) NOT NULL,
c_relatn varchar(2) NOT NULL,
c_legbas varchar(2) NOT NULL,
c_admin varchar(2) NOT NULL,
geocode varchar(3) NOT NULL,
lsabound varchar(1) NOT NULL,
startdat varchar(10),
enddate varchar(10),
popu_lsa integer NOT NULL,
centlib integer NOT NULL,
branlib integer NOT NULL,
bkmob integer NOT NULL,
master numeric(8,2) NOT NULL,
libraria numeric(8,2) NOT NULL,
totstaff numeric(8,2) NOT NULL,
locgvt integer NOT NULL,
stgvt integer NOT NULL,
fedgvt integer NOT NULL,
totincm integer NOT NULL,
salaries integer,
benefit integer,
staffexp integer,
prmatexp integer NOT NULL,
elmatexp integer NOT NULL,
totexpco integer NOT NULL,
totopexp integer NOT NULL,
lcap_rev integer NOT NULL,
scap_rev integer NOT NULL,
fcap_rev integer NOT NULL,
cap_rev integer NOT NULL,
capital integer NOT NULL,
bkvol integer NOT NULL,
ebook integer NOT NULL,
audio integer NOT NULL,
video integer NOT NULL,
databases integer NOT NULL,
subscrip integer NOT NULL,
hrs_open integer NOT NULL,
visits integer NOT NULL,
referenc integer NOT NULL,
regbor integer NOT NULL,
totcir integer NOT NULL,
kidcircl integer NOT NULL,
loanto integer NOT NULL,
loanfm integer NOT NULL,
totpro integer NOT NULL,
totatten integer NOT NULL,
gpterms integer NOT NULL,
pitusr integer NOT NULL,
yr_sub integer NOT NULL,
obereg varchar(2) NOT NULL,
rstatus integer NOT NULL,
statstru varchar(2) NOT NULL,
statname varchar(2) NOT NULL,
stataddr varchar(2) NOT NULL,
longitud numeric(10,7) NOT NULL,
latitude numeric(10,7) NOT NULL,
fipsst varchar(2) NOT NULL,
fipsco varchar(3) NOT NULL
);
CREATE INDEX libname2009_idx ON pls_fy2009_pupld09a (libname);
CREATE INDEX stabr2009_idx ON pls_fy2009_pupld09a (stabr);
CREATE INDEX city2009_idx ON pls_fy2009_pupld09a (city);
CREATE INDEX visits2009_idx ON pls_fy2009_pupld09a (visits);
COPY pls_fy2009_pupld09a
FROM '/Users/tbroderick/anaconda3/envs/pracSQL/Chapter_08/pls_fy2009_pupld09a.csv'
WITH (FORMAT CSV, HEADER);
"
dbGetQuery(con, sql)
sql <- "SELECT * FROM pls_fy2009_pupld09a"
df09 <- dbGetQuery(con, sql)
nrow(df09)
sql <- "SELECT * FROM pls_fy2014_pupld14a"
df14 <- dbGetQuery(con, sql)
nrow(df14)
sql <- "SELECT * FROM pls_fy2009_pupld09a"
df09 <- dbGetQuery(con, sql)
nrow(df09)
sql <- "
SELECT count(salaries) FROM pls_fy2014_pupld14a
"
dftest <- dbGetQuery(con, sql)
nrow(dftest)
sql <- "
SELECT count(salaries) FROM pls_fy2014_pupld14a;
"
dftest <- dbGetQuery(con, sql)
nrow(dftest)
View(dftest)
dbGetQuery(con, sql)
# count the values in the salary column
sql <- "
SELECT count(salaries) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
sql <- "
SELECT count(libname) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
sql <- "
SELECT count(distict libname) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
sql <- "
SELECT count(DISTINCT libname) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
# let's see min and max visits
sql <- "
SELECT max(visits), min(visits) FROM pls_fy2014_pupld14a;"
dbGetQuery(con, sql)
sql <- "
SELECT stabr FROM pls_fy2014_pupld14a
GROUP BY stabr ORDER BY stabr;
"
dbGetQuery(con, sql)
sql <- "
SELECT city, stabr FROM pls_fy2014_pupld14a
GROUP BY city, stabr ORDER BY city, stabr;
"
dbGetQuery(con, sql)
dfcity <- dbGetQuery(con, sql)
View(dfcity)
nrow(dfcity)
sql <- "
SELECT stabr, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr ORDER BY count(*) DESC;
"
dfcount <- dbGetQuery(con, sql)
View(dfcount)
View(dfcity)
# let's try and count centlib and branlib by state
sql <- "
SELECT stabr, centlib, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr ORDER BY count(*) DESC;
"
dfcenlib <- dbGetQuery(con, sql)
# let's try and count centlib and branlib by state
sql <- "
SELECT stabr, centlib, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr, centlib ORDER BY count(*) DESC;
"
dfcenlib <- dbGetQuery(con, sql)
View(dfcenlib)
# let's try and count branlib by state
sql <- "
SELECT stabr, branlib, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr, branlib ORDER BY count(*) DESC;
"
dfbranlib <- dbGetQuery(con, sql)
View(dfbranlib)
View(dfcity)
View(dfcount)
View(dfcenlib)
View(dfcount)
# let's try and count centlib and branlib by state
sql <- "
SELECT stabr, centlib, sum(*) FROM pls_fy2014_pupld14a
GROUP BY stabr, centlib ORDER BY sum(*) DESC;
"
dfcenlib <- dbGetQuery(con, sql)
# let's try and count centlib and branlib by state
sql <- "
SELECT stabr, sum(centlib) FROM pls_fy2014_pupld14a
GROUP BY stabr, sum(centlib) ORDER BY  sum(centlib) DESC;
"
dfcenlib <- dbGetQuery(con, sql)
# let's try and count branlib by state
sql <- "
SELECT stabr, branlib, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr, branlib ORDER BY count(*) DESC;
"
dfbranlib <- dbGetQuery(con, sql)
View(dfbranlib)
# let's try and count centlib and branlib by state
sql <- "
SELECT stabr, centlib, count(*) FROM pls_fy2014_pupld14a
GROUP BY stabr, centlib ORDER BY count(*) DESC;
"
dfcenlib <- dbGetQuery(con, sql)
View(dfcenlib)
sql <- "
SELECT sum(centlib) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
sql <- "
SELECT sum(branlib) FROM pls_fy2014_pupld14a;
"
dbGetQuery(con, sql)
# let's try and count centlib state
sql <- "
SELECT centlib FROM pls_fy2014_pupld14a;
"
dfcenlib <- dbGetQuery(con, sql)
View(dfcenlib)
# let's try and count centlib state
sql <- "
SELECT sum(centlib) FROM pls_fy2014_pupld14a
WHERE centlib != -3;
"
dfcenlib <- dbGetQuery(con, sql)
View(dfcenlib)
dbGetQuery(con, sql)
sql <- "
SELECT stabr, sum(centlib) FROM pls_fy2014_pupld14a
WHERE centlib != -3;
"
dbGetQuery(con, sql)
sql <- "
SELECT stabr, sum(centlib) FROM pls_fy2014_pupld14a
WHERE centlib != -3
GROUP BY stabr, sum(centlib);
"
dbGetQuery(con, sql)
sql <- "
SELECT stabr, sum(centlib) FROM pls_fy2014_pupld14a
WHERE centlib != -3
GROUP BY stabr, centlib;
"
dbGetQuery(con, sql)
sql <- "
SELECT stabr, sum(centlib) FROM pls_fy2014_pupld14a
WHERE centlib != -3
GROUP BY stabr, centlib
ORDER BY sum(centlib) DESC;
"
dbGetQuery(con, sql)
dfcenlib <- dbGetQuery(con, sql)
View(dfcenlib)
View(dfcity)
View(dfcount)
# let's try and count branlib by state
sql <- "
SELECT sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3;
"
dbGetQuery(con, sql)
# let's try and count branlib by state
sql <- "
SELECT branlib FROM pls_fy2014_pupld14a;
"
dfbranlib <- dbGetQuery(con, sql)
View(dfbranlib)
sql <- "
SELECT sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3;
"
dbGetQuery(con, sql)
sql <- "
SELECT stabr, sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3
GROUP BY stabr, branlib
ORDER BY sum(branlib) DESC;
"
dfbranlib <- dbGetQuery(con, sql)
View(dfbranlib)
View(df14)
sql <- "
SELECT city, sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3
GROUP BY city, branlib
ORDER BY sum(branlib) DESC;
"
dfbrancit <- dbGetQuery(con, sql)
View(dfbrancit)
sql <- "
SELECT city, stabr, sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3
GROUP BY city, stabr, branlib
ORDER BY sum(branlib) DESC;
"
dfbrancit <- dbGetQuery(con, sql)
View(dfbrancit)
sql <- "
SELECT count(city) FROM pls_fy2014_pupld14a
WHERE city = 'Downey';
"
dbGetQuery(con, sql)
sql <- "
SELECT count(city) FROM pls_fy2014_pupld14a
WHERE city = 'DOWNEY';
"
dbGetQuery(con, sql)
df <- dbGetQuery(con, sql)
View(df)
sql <- "
SELECT city, stabr, branlib FROM pls_fy2014_pupld14a
WHERE city = 'DOWNEY';
"
df <- dbGetQuery(con, sql)
sql <- "
SELECT libname, city, stabr, branlib FROM pls_fy2014_pupld14a
WHERE city = 'DOWNEY';
"
df <- dbGetQuery(con, sql)
sql <- "
SELECT libname, city, stabr, sum(branlib) FROM pls_fy2014_pupld14a
WHERE branlib != -3
ORDER BY sum(branlib) DESC;
"
dfbrancit <- dbGetQuery(con, sql)
sql <- "
SELECT libname, city, stabr, branlib FROM pls_fy2014_pupld14a
WHERE branlib != -3
ORDER BY branlib DESC;
"
dfbrancit <- dbGetQuery(con, sql)
View(dfbrancit)
sql <- "
SELECT libname, city, stabr, branlib FROM pls_fy2014_pupld14a
WHERE branlib > 0
ORDER BY branlib DESC;
"
dfbrancit <- dbGetQuery(con, sql)
nrow(dfbrancit)
